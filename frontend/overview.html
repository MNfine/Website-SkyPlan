<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="overviewTitle">SkyPlan - Tổng quan chuyến đi</title>

  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <!-- Font Awesome CDN for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="assets/styles/reset.css">
  <link rel="stylesheet" href="assets/styles/index.css">
  <link rel="stylesheet" href="assets/styles/flags.css">
  <link rel="stylesheet" href="assets/styles/header.css">
  <link rel="stylesheet" href="assets/styles/footer.css">
  <link rel="stylesheet" href="assets/styles/overview.css">
</head>

<body>
  <!-- Header -->
  <div id="header-container"></div>

  <!-- Progress Bar -->
  <div class="container overview-flow">
    <div class="steps">
      <div class="step completed">
        <div class="dot">1</div>
        <div class="label" data-i18n="step1">Tìm kiếm</div>
      </div>
      <div class="step completed">
        <div class="dot">2</div>
        <div class="label" data-i18n="step2">Chọn chuyến bay</div>
      </div>
      <div class="step completed">
        <div class="dot">3</div>
        <div class="label" data-i18n="step3">Chọn giá</div>
      </div>
      <div class="step completed">
        <div class="dot">4</div>
        <div class="label" data-i18n="step4">Thông tin khách hàng</div>
      </div>
      <div class="step completed">
        <div class="dot">5</div>
        <div class="label" data-i18n="step5">Dịch vụ thêm</div>
      </div>
      <div class="step active">
        <div class="dot">6</div>
        <div class="label" data-i18n="step6">Thanh toán</div>
      </div>
      <div class="progress"></div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container">
    <div class="overview-content">
      <!-- Trip Summary -->
      <div class="trip-summary">
        <h2>
          <span id="route-heading">Hà Nội đến Hồ Chí Minh</span>

          - <span data-i18n="overviewTitle">Tổng quan chuyến đi</span>
        </h2>

        <!-- Flight Information -->
        <div class="flight-info">
          <div class="flight-segment">
            <div class="flight-header">
              <span class="flight-date"><span class="date-text">Ngày 10 thg 6, 2023</span> - <span
                  data-i18n="outboundLabel">Chiều đi</span></span>
              <span class="flight-type" data-i18n="passengerClass">Phổ thông</span>
            </div>
            <div class="flight-details">
              <div class="departure">
                <div class="time">10:45</div>
                <div class="location">HAN</div>
                <div class="city city-depart-out">Hà Nội</div>
              </div>
              <div class="flight-path">
                <div class="duration">2h 15m</div>
                <div class="route-line">
                  <div class="route-dot"></div>
                  <div class="route-dash"></div>
                  <div class="route-dot"></div>
                </div>
                <div class="stops" data-i18n="directFlight">Bay thẳng</div>
              </div>
              <div class="arrival">
                <div class="time">13:00</div>
                <div class="location">SGN</div>
                <div class="city city-arrive-out">Hồ Chí Minh</div>
              </div>
            </div>
          </div>

          <div class="flight-segment">
            <div class="flight-header">
              <span class="flight-date"><span class="date-text">Ngày 18 thg 8, 2023</span> - <span
                  data-i18n="inboundLabel">Chiều về</span></span>
              <span class="flight-type" data-i18n="passengerClass">Phổ thông</span>
            </div>
            <div class="flight-details">
              <div class="departure">
                <div class="time">16:20</div>
                <div class="location">SGN</div>
                <div class="city city-depart-ret">Hồ Chí Minh</div>
              </div>
              <div class="flight-path">
                <div class="duration">2h 10m</div>
                <div class="route-line">
                  <div class="route-dot"></div>
                  <div class="route-dash"></div>
                  <div class="route-dot"></div>
                </div>
                <div class="stops" data-i18n="directFlight">Bay thẳng</div>
              </div>
              <div class="arrival">
                <div class="time">18:30</div>
                <div class="location">HAN</div>
                <div class="city city-arrive-ret">Hà Nội</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
          <div class="summary-card">
            <h3 data-i18n="passengerClass">Phổ thông</h3>
            <div class="card-content">
              <div class="passenger-info">
                <i class="fas fa-user"></i>
                <span data-i18n="passenger">1 hành khách</span>
              </div>
              <div class="luggage-info">
                <i class="fas fa-suitcase"></i>
                <span data-i18n="handLuggage">Hành lý xách tay: 7kg</span>
              </div>
              <div class="luggage-info">
                <i class="fas fa-luggage-cart"></i>
                <span data-i18n="checkedLuggage">Hành lý ký gửi: 23kg</span>
              </div>
            </div>
          </div>

          <div class="summary-card services-card">
            <h3 data-i18n="noExtras">Không có dịch vụ thêm</h3>
            <div class="card-content">
              <div class="service-illustration">
                <img src="assets/images/no-extras.png" alt="No additional services" class="service-img">
              </div>
            </div>
          </div>
        </div>

        <!-- Total Price -->
        <div class="total-section">
          <div class="total-price">
            <span class="price-label" data-i18n="totalLabel">Tổng cộng</span>
            <span class="price-amount">1.598.000 VND</span>
          </div>
          <a href="payment.html" class="confirm-btn pay-btn">
            <span data-i18n="confirmBooking">Xác nhận đặt vé</span>
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer-container"></div>

  <!-- JavaScript -->
  <script src="assets/scripts/common.js"></script>
  <script src="assets/scripts/overview_translations.js"></script>

  <!-- Load Components -->
  <script>
    // Function to handle component loading errors
    function handleComponentError(componentName) {
      console.error(`Failed to load ${componentName} component`);
    }

    // Load header
    fetch('components/header.html')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();
      })
      .then(data => {
        document.getElementById('header-container').innerHTML = data;
        // After header loads, initialize language functionality if available
        if (typeof initializeLanguageSelector === 'function') {
          initializeLanguageSelector();
        }
        // Initialize mobile menu after header loads
        if (typeof initializeMobileMenu === 'function') {
          initializeMobileMenu();
        }
        // Re-apply translations and sync header UI with saved language
        const lang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'vi';
        if (typeof applyOverviewTranslations === 'function') {
          applyOverviewTranslations(lang);
        }
        // Update selected language UI in header to reflect saved language
        if (typeof updateSelectedLanguage === 'function') {
          updateSelectedLanguage(lang);
        }
      })
      .catch(error => {
        handleComponentError('header');
      });

    // Load footer
    fetch('components/footer.html')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();
      })
      .then(data => {
        document.getElementById('footer-container').innerHTML = data;
        // Re-apply all translations to include footer
        const lang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'vi';
        if (typeof applyOverviewTranslations === 'function') {
          applyOverviewTranslations(lang);
        }
      })
      .catch(error => {
        handleComponentError('footer');
      });
  </script>

  <script>
    // Ẩn nút thanh toán nếu đã thanh toán thành công (dựa vào localStorage hoặc query string)
    (function () {
      const paid = localStorage.getItem('lastTxnRef') && localStorage.getItem('lastAmount');
      if (paid) {
        const payBtn = document.querySelector('.pay-btn');
        if (payBtn) payBtn.style.display = 'none';
      }
    })();
  </script>

  <script>
    // Ẩn nút thanh toán cho từng vé đã thanh toán thành công
    (function () {
      // Giả sử mỗi vé có 1 container với id hoặc class chứa bookingCode
      document.querySelectorAll('[data-booking-code]').forEach(function (ticket) {
        const code = ticket.getAttribute('data-booking-code');
        if (code && localStorage.getItem('paid_' + code) === 'true') {
          const payBtn = ticket.querySelector('.pay-btn');
          if (payBtn) payBtn.style.display = 'none';
        }
      });
    })();
  </script>

  <script>
    // Tự động dịch khi trang load
    document.addEventListener('DOMContentLoaded', function () {
      const lang = localStorage.getItem('preferredLanguage') || 'vi';
      if (typeof applyOverviewTranslations === 'function') {
        applyOverviewTranslations(lang);
      }
    });
  </script>
</body>

</html>