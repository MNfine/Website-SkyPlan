<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SkyPlane – Search Results</title>
    <link rel="stylesheet" href="assets/styles/search.css" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/styles/reset.css">
    <link rel="stylesheet" href="assets/styles/index.css">
    <link rel="stylesheet" href="assets/styles/flags.css">
    <link rel="stylesheet" href="assets/styles/header.css">
    <link rel="stylesheet" href="assets/styles/footer.css">
    <link rel="stylesheet" href="assets/styles/user-menu.css">
</head>

<body class="with-fixed-header with-fixed-footer">
    <div id="header-container"></div>

    <main class="sp-container">
        <aside class="sp-filters" aria-label="Search filters">
            <h2 class="sp-title">Chuyến đi của bạn</h2>

            <div class="sp-field">
                <label for="from" class="sp-label">Từ</label>
                <select id="from" class="sp-input">
                    <option value="AnGiang">An Giang</option>
                    <option value="CanTho">Cần Thơ</option>
                    <option value="DaNang">Đà Nẵng</option>
                    <option value="DakLak">Đắk Lắk</option>
                    <option value="DienBien">Điện Biên</option>
                    <option value="GiaLai">Gia Lai</option>
                    <option value="HaNoi">Hà Nội</option>
                    <option value="HaiPhong">Hải Phòng</option>
                    <option value="HoChiMinh">Hồ Chí Minh</option>
                    <option value="Hue">Huế</option>
                    <option value="KhanhHoa">Khánh Hòa</option>
                    <option value="LamDong">Lâm Đồng</option>
                    <option value="NgheAn">Nghệ An</option>
                    <option value="QuangNinh">Quảng Ninh</option>
                    <option value="QuangTri">Quảng Trị</option>
                    <option value="SonLa">Sơn La</option>
                    <option value="ThanhHoa">Thanh Hóa</option>
                </select>
            </div>

            <div class="sp-field">
                <label for="to" class="sp-label">Đến</label>
                <select id="to" class="sp-input">
                    <option value="AnGiang">An Giang</option>
                    <option value="CanTho">Cần Thơ</option>
                    <option value="DaNang">Đà Nẵng</option>
                    <option value="DakLak">Đắk Lắk</option>
                    <option value="DienBien">Điện Biên</option>
                    <option value="GiaLai">Gia Lai</option>
                    <option value="HaNoi">Hà Nội</option>
                    <option value="HaiPhong">Hải Phòng</option>
                    <option value="HoChiMinh">Hồ Chí Minh</option>
                    <option value="Hue">Huế</option>
                    <option value="KhanhHoa">Khánh Hòa</option>
                    <option value="LamDong">Lâm Đồng</option>
                    <option value="NgheAn">Nghệ An</option>
                    <option value="QuangNinh">Quảng Ninh</option>
                    <option value="QuangTri">Quảng Trị</option>
                    <option value="SonLa">Sơn La</option>
                    <option value="ThanhHoa">Thanh Hóa</option>
                </select>
            </div>

            <div class="sp-trip-type">
                <label class="sp-radio">
                    <input type="radio" name="trip-type" value="round-trip" checked>
                    <span>Khứ hồi</span>
                </label>
                <label class="sp-radio">
                    <input type="radio" name="trip-type" value="one-way">
                    <span>Một chiều</span>
                </label>
            </div>
            
            <div class="sp-row sp-field-group">
                <div class="sp-field">
                    <label for="dep" class="sp-label">Ngày đi</label>
                    <input id="dep" class="sp-input" type="date" />
                </div>
                <div class="sp-field" id="return-date-field">
                    <label for="ret" class="sp-label">Ngày về</label>
                    <input id="ret" class="sp-input" type="date" />
                </div>
            </div>

            <button class="sp-btn sp-btn-secondary" type="button">
                <i class="fa-solid fa-magnifying-glass"></i>
                Tìm kiếm
            </button>

            <h3 class="sp-subtitle">Bộ lọc</h3>

            <section class="sp-section">
                <div class="sp-section-title">Số điểm dừng</div>
                <label class="sp-choice"><input type="radio" name="stops" checked> Bay thẳng</label>
                <label class="sp-choice"><input type="radio" name="stops"> 1 điểm dừng</label>
                <label class="sp-choice"><input type="radio" name="stops"> 2 điểm dừng</label>
                <label class="sp-choice"><input type="radio" name="stops"> 3 điểm dừng</label>
            </section>

            <section class="sp-section">
                <div class="sp-section-title">Hành lý</div>
                <div class="sp-counter" data-counter="cabin">
                    <span>Hành lý sách tay</span>
                    <button class="sp-chip" data-minus aria-label="decrease cabin">−</button>
                    <span class="sp-count" data-value>2</span>
                    <button class="sp-chip" data-plus aria-label="increase cabin">＋</button>
                </div>
                <div class="sp-counter" data-counter="checked">
                    <span>Hành lý ký gửi</span>
                    <button class="sp-chip" data-minus aria-label="decrease checked">−</button>
                    <span class="sp-count" data-value>0</span>
                    <button class="sp-chip" data-plus aria-label="increase checked">＋</button>
                </div>
            </section>

            <section class="sp-section">
                <div class="sp-section-title">Giờ bay</div>
                <label class="sp-choice"><input type="radio" name="time" checked>5:00 - 11:49</label>
                <label class="sp-choice"><input type="radio" name="time">12:00 - 17:59</label>
                <label class="sp-choice"><input type="radio" name="time"> 18:00 - 23:59</label>
                <label class="sp-choice"><input type="radio" name="time"> 00:00 - 4:59</label>
            </section>

            <section class="sp-section">
                <div class="sp-section-title">Ngân sách</div>
                <div class="sp-price-top"><span>0 VND – 5.000.000 VND</span><span>Bất kỳ</span></div>
                <input id="priceRange" class="sp-range" type="range" max="5000000" step="50000" value="2000000" />
                <div class="sp-price-bottom"><span>0 VND</span><span id="priceOut">2.000.000 VND</span></div>
            </section>
        </aside>

        <section class="sp-results" aria-live="polite">

        </section>
    </main>

    <div id="footer-container"></div>

    <script src="assets/scripts/search.js"></script>
    <script src="assets/scripts/common.js"></script>
    <script src="assets/scripts/search_translations.js"></script>
    <script src="assets/scripts/search_filter.js"></script>
    
    <script>
        function handleComponentError(componentName) {
            console.error(`Failed to load ${componentName} component`);
        }

        function initializeLanguage() {
            // Get or set language
            let currentLang = localStorage.getItem('preferredLanguage');
            if (!currentLang) {
                currentLang = 'vi';
                localStorage.setItem('preferredLanguage', 'vi');
            }

            document.documentElement.lang = currentLang;

            // Initialize components after a short delay
            setTimeout(() => {
                if (typeof initializeMobileMenu === 'function') {
                    initializeMobileMenu();
                    console.log('Mobile menu initialized');
                }
                if (typeof initializeLanguageSelector === 'function') {
                    initializeLanguageSelector();
                    console.log('Language selector initialized');
                }

                if (typeof initializeSearchFilter === 'function') {
                    initializeSearchFilter();
                    console.log('Search filter initialized');
                }

                // Initialize search translations
                if (typeof initSearchTranslations === 'function') {
                    initSearchTranslations();
                    console.log('Search translations initialized');
                }

                // Apply language to search page
                if (typeof changeSearchLanguage === 'function') {
                    changeSearchLanguage(currentLang);
                    console.log('Search language applied:', currentLang);
                }

                if (typeof updateSelectedLanguage === 'function') {
                    updateSelectedLanguage(currentLang);
                    console.log('Language selector updated:', currentLang);
                }
            }, 200);
        }

        function initializeApp() {
            // Load header
            fetch('components/header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                    console.log('Header loaded successfully');

                    // After header loads, initialize language functionality
                    initializeLanguage();
                })
                .catch(error => {
                    handleComponentError('header');
                    console.error('Error loading header:', error);
                    // Still initialize language even if header fails
                    initializeLanguage();
                });

            // Load footer
            fetch('components/footer.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('footer-container').innerHTML = data;
                    console.log('Footer loaded successfully');
                })
                .catch(error => {
                    handleComponentError('footer');
                    console.error('Error loading footer:', error);
                });
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // Tự động tải dữ liệu chuyến bay khi trang được tải
            setTimeout(function() {
                if (typeof fetchFlights === 'function') {
                    fetchFlights();
                }
            }, 500);
        });
    </script>
</body>

</html>