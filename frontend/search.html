<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SkyPlane – Search Results</title>
    <link rel="stylesheet" href="assets/styles/search.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="assets/styles/reset.css">
    <link rel="stylesheet" href="assets/styles/index.css">
    <link rel="stylesheet" href="assets/styles/flags.css">
    <link rel="stylesheet" href="assets/styles/header.css">
    <link rel="stylesheet" href="assets/styles/footer.css">
</head>

<body class="with-fixed-header with-fixed-footer">
    <div id="header-container"></div>

    <main class="sp-container">
        <aside class="sp-filters" aria-label="Search filters">
            <h2 class="sp-title">Chuyến đi của bạn</h2>

            <form id="spSearchForm">
                <div class="sp-field">
                    <label class="sp-label" data-i18n="search.from">Từ</label>
                    <select id="fromCity" class="sp-input sp-city-dropdown"></select>
                </div>

                <div class="sp-field">
                    <label class="sp-label" data-i18n="search.to">Đến</label>
                    <select id="toCity" class="sp-input sp-city-dropdown"></select>
                </div>

                <div class="sp-row sp-field-group">
                    <div class="sp-field">
                        <label for="dep" class="sp-label">Ngày đi</label>
                        <input id="dep" class="sp-input" type="date" value="2023-06-10">
                    </div>
                    <div class="sp-field">
                        <label for="ret" class="sp-label">Ngày về</label>
                        <input id="ret" class="sp-input" type="date" value="2023-08-18">
                    </div>
                </div>

                <button class="sp-btn sp-btn-secondary" type="button">
                <i class="fa-solid fa-magnifying-glass"></i>
                Tìm kiếm
            </button>

                <h3 class="sp-subtitle">Bộ lọc</h3>

                <section class="sp-section" aria-labelledby="budget-heading">
                    <h4 id="budget-heading" class="sp-section-title">Ngân sách</h4>
                    <div class="sp-price-top"><span>0 VND – 5.000.000 VND</span><span>Bất kỳ</span></div>
                    <input id="priceRange" class="sp-range" type="range" max="5000000" step="50000" value="2000000">
                    <div class="sp-price-bottom"><span>0 VND</span><span id="priceOut">2.000.000 VND</span></div>
                </section>


                <section class="sp-section" aria-labelledby="time-heading">
                    <h4 id="time-heading" class="sp-section-title">Giờ bay</h4>
                    <label class="sp-choice"><input type="radio" name="time" checked>5:00 - 11:49</label>
                    <label class="sp-choice"><input type="radio" name="time">12:00 - 17:59</label>
                    <label class="sp-choice"><input type="radio" name="time"> 18:00 - 23:59</label>
                    <label class="sp-choice"><input type="radio" name="time"> 00:00 - 4:59</label>
                </section>


        </aside>

        <section class="sp-results" aria-live="polite" aria-labelledby="results-heading">
            <h2 id="results-heading" class="sr-only">Kết quả tìm kiếm</h2>

            <article class="sp-card" aria-labelledby="card1-heading">
                <h3 id="card1-heading" class="sr-only">Chuyến bay 06:00 → 08:10 và 09:00 → 11:05</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">06:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h10m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">08:10</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">09:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">11:05</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.200.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card2-heading">
                <h3 id="card2-heading" class="sr-only">Chuyến bay 07:30 → 09:45 và 10:00 → 12:15</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">07:30</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h15m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">09:45</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">10:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h15m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">12:15</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.350.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card3-heading">
                <h3 id="card3-heading" class="sr-only">Chuyến bay 09:00 → 11:00 và 12:00 → 14:00</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">09:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h00m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">11:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">12:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h00m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">14:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.400.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card4-heading">
                <h3 id="card4-heading" class="sr-only">Chuyến bay 11:30 → 13:35 và 14:00 → 16:05</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">11:30</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">13:35</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">14:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">16:05</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.550.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card5-heading">
                <h3 id="card5-heading" class="sr-only">Chuyến bay 13:00 → 15:10 và 13:40 → 15:45</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">13:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h10m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">15:10</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">13:40</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">15:45</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.650.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card6-heading">
                <h3 id="card6-heading" class="sr-only">Chuyến bay 14:30 → 16:35 và 15:30 → 17:40</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">14:30</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">16:35</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">15:30</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h10m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">17:40</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.700.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card7-heading">
                <h3 id="card7-heading" class="sr-only">Chuyến bay 16:00 → 18:00 và 17:00 → 19:05</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">16:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h00m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">18:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">17:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">19:05</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.780.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card8-heading">
                <h3 id="card8-heading" class="sr-only">Chuyến bay 18:00 → 20:15 và 19:00 → 21:10</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">18:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h15m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">20:15</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">19:00</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h10m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">21:10</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">1.900.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card9-heading">
                <h3 id="card9-heading" class="sr-only">Chuyến bay 20:00 → 22:05 và 20:30 → 22:30</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">20:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h05m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">22:05</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">20:30</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h00m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">22:30</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">2.000.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

            <article class="sp-card" aria-labelledby="card10-heading">
                <h3 id="card10-heading" class="sr-only">Chuyến bay 22:00 → 00:10 và 21:30 → 23:45</h3>
                <div class="sp-card-body">
                    <div class="sp-date">10/06/2023 · Khởi hành</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">22:00</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h10m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">00:10</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                    </div>

                    <hr class="sp-divider">

                    <div class="sp-date">18/08/2023 · Về</div>
                    <div class="sp-itinerary">
                        <div>
                            <div class="sp-time">21:30</div>
                            <div class="sp-meta">Hà Nội (HAN)</div>
                        </div>
                        <div class="sp-mid">
                            <i class="fa-solid fa-plane sp-plane"></i>
                            <span class="sp-duration">2h15m<br>Bay thẳng</span>
                        </div>
                        <div>
                            <div class="sp-time">23:45</div>
                            <div class="sp-meta">Hồ Chí Minh (SGN)</div>
                        </div>
                    </div>
                </div>
                <aside class="sp-card-aside">
                    <div class="sp-price">2.150.000 VND</div>
                    <button class="sp-btn sp-btn-block">Chọn chuyến bay</button>
                </aside>
            </article>

        </section>
    </main>

    <div id="spModal" class="sp-modal" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="sp-modal__backdrop" data-close></div>

        <div class="sp-modal__dialog" role="document" aria-labelledby="spModalTitle">
            <div class="sp-modal__header">
                <h2 id="spModalTitle">Flight Details</h2>
                <button class="sp-modal__close" aria-label="Close" data-close>&times;</button>
            </div>

            <div class="sp-modal__content">
                <!-- OUTBOUND -->
                <section class="sp-leg" aria-labelledby="outbound-heading">
                    <h3 id="outbound-heading" class="sr-only">Chiều đi</h3>
                    <div class="sp-leg__title">To <span data-to-city>—</span></div>
                    <div class="sp-leg__panel">
                        <div class="sp-leg__grid">
                            <div class="sp-leg__date">
                                <i class="fa-regular fa-calendar"></i>
                                <span data-out-date>—</span>
                            </div>
                            <div class="sp-leg__timeline">
                                <div class="sp-node">
                                    <div class="sp-node__time" data-out-dep-time>—</div>
                                    <div class="sp-node__icon"><i class="fa-solid fa-location-pin"></i></div>
                                    <div class="sp-node__text" data-out-dep-airport>—</div>
                                </div>
                                <div class="sp-node sp-node--plane">
                                    <div class="sp-node__time">&nbsp;</div>
                                    <div class="sp-node__icon"><i class="fa-solid fa-plane"></i></div>
                                </div>
                                <div class="sp-node">
                                    <div class="sp-node__time" data-out-arr-time>—</div>
                                    <div class="sp-node__icon"><i class="fa-solid fa-location-dot"></i></div>
                                    <div class="sp-node__text" data-out-arr-airport>—</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- INBOUND -->
                <section class="sp-leg" aria-labelledby="inbound-heading">
                    <h3 id="inbound-heading" class="sr-only">Chiều về</h3>
                    <div class="sp-leg__title">To <span data-from-city>—</span></div>
                    <div class="sp-leg__panel">
                        <div class="sp-leg__grid">
                            <div class="sp-leg__date">
                                <i class="fa-regular fa-calendar"></i>
                                <span data-in-date>—</span>
                            </div>
                            <div class="sp-leg__timeline">
                                <div class="sp-node">
                                    <div class="sp-node__time" data-in-dep-time>—</div>
                                    <div class="sp-node__icon"><i class="fa-solid fa-location-pin"></i></div>
                                    <div class="sp-node__text" data-in-dep-airport>—</div>
                                </div>
                                <div class="sp-node sp-node--plane">
                                    <div class="sp-node__time">&nbsp;</div>
                                    <div class="sp-node__icon"><i class="fa-solid fa-plane"></i></div>
                                </div>
                                <div class="sp-node">
                                    <div class="sp-node__time" data-in-arr-time>—</div>
                                    <div class="sp-node__icon"><i class="fa-solid fa-location-dot"></i></div>
                                    <div class="sp-node__text" data-in-arr-airport>—</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>

            <div class="sp-modal__footer">
                <button class="sp-btn sp-btn--ghost" type="button">Chia sẻ chuyến đi</button>
                <button id="spBookBtn" class="sp-btn sp-btn--primary" type="button">Đặt ngay với giá</button>
            </div>
        </div>
    </div>



    <div id="footer-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', async() => {
            const loadComponent = async(id, file) => {
                const container = document.getElementById(id);
                if (container) {
                    try {
                        const html = await fetch(file).then(r => r.text());
                        container.innerHTML = html;
                    } catch (e) {
                        console.error(`Không load được ${file}:`, e);
                    }
                }
            };
            await loadComponent('header-container', 'components/header.html');
            await loadComponent('footer-container', 'components/footer.html');
        });
    </script>

    <script>
        (function() {
            function $(sel, ctx) {
                return (ctx || document).querySelector(sel);
            }

            function $all(sel, ctx) {
                return Array.prototype.slice.call((ctx || document).querySelectorAll(sel));
            }

            function text(el) {
                return el && el.textContent ? el.textContent.trim() : '';
            }

            function setText(root, sel, val) {
                var el = root.querySelector(sel);
                if (el) el.textContent = (val && String(val).trim()) || '—';
            }

            function initSlider() {
                var slider = document.getElementById('priceRange');
                var out = document.getElementById('priceOut');
                if (!slider || !out) return;

                function fmt(v) {
                    return Number(v).toLocaleString('vi-VN') + ' VND';
                }

                function paintRange() {
                    var min = Number(slider.min || 0);
                    var max = Number(slider.max || 100);
                    var val = Number(slider.value || 0);
                    var pct = ((val - min) / (max - min)) * 100;

                    try {
                        slider.style.setProperty('--sp-range-pct', pct + '%');
                    } catch (e) {}

                    slider.style.background = 'linear-gradient(to right, var(--sp-primary) ' + pct + '%, #e5e7eb ' + pct + '%)';
                    out.textContent = fmt(val);
                }
                paintRange();
                slider.addEventListener('input', paintRange);
                slider.addEventListener('change', paintRange);
            }

            function initModal() {
                var modal = document.getElementById('spModal');
                var bookBtn = document.getElementById('spBookBtn');
                if (!modal || !bookBtn) return;

                function readItinerary(it) {
                    if (!it) return {
                        depTime: '',
                        arrTime: '',
                        depAirport: '',
                        arrAirport: ''
                    };
                    var times = $all('.sp-time', it);
                    var metas = $all('.sp-meta', it);
                    return {
                        depTime: text(times[0]),
                        arrTime: text(times[1]),
                        depAirport: text(metas[0]),
                        arrAirport: text(metas[1])
                    };
                }

                function cleanCity(s) {
                    s = s || '';
                    var i = s.indexOf('(');
                    return (i >= 0 ? s.slice(0, i) : s).trim();
                }

                function cleanDate(s) {
                    s = s || '';
                    return s.replace('· Departure', '').replace('· Return', '').trim();
                }

                function parseCard(card) {
                    var itins = $all('.sp-itinerary', card);
                    var dates = $all('.sp-date', card);

                    var outLeg = readItinerary(itins[0]);
                    var inLeg = readItinerary(itins[1]);

                    var outDate = '',
                        inDate = '';
                    if (dates.length === 2) {
                        outDate = cleanDate(text(dates[0]));
                        inDate = cleanDate(text(dates[1]));
                    } else if (dates.length === 1) {
                        inDate = cleanDate(text(dates[0]));
                    }

                    setText(modal, '[data-to-city]', cleanCity(outLeg.arrAirport || outLeg.depAirport));
                    setText(modal, '[data-from-city]', cleanCity(inLeg.arrAirport || inLeg.depAirport));

                    setText(modal, '[data-out-date]', outDate);
                    setText(modal, '[data-out-dep-time]', outLeg.depTime);
                    setText(modal, '[data-out-dep-airport]', outLeg.depAirport);
                    setText(modal, '[data-out-arr-time]', outLeg.arrTime);
                    setText(modal, '[data-out-arr-airport]', outLeg.arrAirport);

                    setText(modal, '[data-in-date]', inDate);
                    setText(modal, '[data-in-dep-time]', inLeg.depTime);
                    setText(modal, '[data-in-dep-airport]', inLeg.depAirport);
                    setText(modal, '[data-in-arr-time]', inLeg.arrTime);
                    setText(modal, '[data-in-arr-airport]', inLeg.arrAirport);

                    var priceEl = card.querySelector('.sp-price');
                    var price = text(priceEl);
                    const lang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'vi';
                    const t = MODAL_I18N[lang] || MODAL_I18N.vi;
                    bookBtn.textContent = t.bookPrefix + price;

                }

                function openModal() {
                    modal.classList.add('is-open');
                    modal.setAttribute('aria-hidden', 'false');
                    document.addEventListener('keydown', onEsc);
                }

                function closeModal() {
                    modal.classList.remove('is-open');
                    modal.setAttribute('aria-hidden', 'true');
                    document.removeEventListener('keydown', onEsc);
                }

                function onEsc(e) {
                    if (e.key === 'Escape') closeModal();
                }

                modal.addEventListener('click', function(e) {
                    if (e.target && e.target.getAttribute('data-close') !== null) closeModal();
                });

                $all('.sp-card .sp-btn.sp-btn-block').forEach(function(btn) {
                    btn.addEventListener('click', function() {
                        var card = btn.closest('.sp-card');
                        parseCard(card);
                        openModal();
                    });
                });
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    initSlider();
                    initModal();
                });
            } else {
                initSlider();
                initModal();
            }
        })();
    </script>
    <script src="assets/scripts/common.js"></script>
    <script src="assets/scripts/search_translations.js"></script>
    <script src="assets/scripts/search_filter.js"></script>


    <script>
        function handleComponentError(componentName) {
            console.error(`Failed to load ${componentName} component`);
        }

        function initializeLanguage() {
            // Get or set language
            let currentLang = localStorage.getItem('preferredLanguage');
            if (!currentLang) {
                currentLang = 'vi';
                localStorage.setItem('preferredLanguage', 'vi');
            }

            document.documentElement.lang = currentLang;

            // Initialize components after a short delay
            setTimeout(() => {
                if (typeof initializeMobileMenu === 'function') {
                    initializeMobileMenu();
                    console.log('Mobile menu initialized');
                }
                if (typeof initializeLanguageSelector === 'function') {
                    initializeLanguageSelector();
                    console.log('Language selector initialized');
                }

                if (typeof initializeSearchFilter === 'function') {
                    initializeSearchFilter();
                    console.log('Search filter initialized');
                }

                // Initialize search translations
                if (typeof initSearchTranslations === 'function') {
                    initSearchTranslations();
                    console.log('Search translations initialized');
                }

                // Apply language to search page
                if (typeof changeSearchLanguage === 'function') {
                    changeSearchLanguage(currentLang);
                    console.log('Search language applied:', currentLang);
                }

                if (typeof updateSelectedLanguage === 'function') {
                    updateSelectedLanguage(currentLang);
                    console.log('Language selector updated:', currentLang);
                }
                try {
                    document.dispatchEvent(new CustomEvent('languageChanged', {
                        detail: {
                            lang: currentLang
                        }
                    }));
                } catch (e) {}
            }, 200);
        }

        function initializeApp() {
            // Load header
            fetch('components/header.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('header-container').innerHTML = data;
                    console.log('Header loaded successfully');

                    // After header loads, initialize language functionality
                    initializeLanguage();
                })
                .catch(error => {
                    handleComponentError('header');
                    console.error('Error loading header:', error);
                    // Still initialize language even if header fails
                    initializeLanguage();
                });

            // Load footer
            fetch('components/footer.html')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    document.getElementById('footer-container').innerHTML = data;
                    console.log('Footer loaded successfully');
                })
                .catch(error => {
                    handleComponentError('footer');
                    console.error('Error loading footer:', error);
                });
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>

    <script>
        (function() {
            // Lấy ngôn ngữ hiện tại
            function getLang() {
                return localStorage.getItem('preferredLanguage') || 'vi';
            }

            // Tạo dropdown cho phần "From" và "To"
            const citySelects = document.querySelectorAll('.sp-city-dropdown');

            citySelects.forEach(select => {
                const lang = getLang();
                const cities = window.SKYPLAN_CITY_TRANSLATIONS[lang];
                select.innerHTML = ''; // xoá sạch option cũ

                // Tạo option mặc định
                const defOpt = document.createElement('option');
                defOpt.textContent = lang === 'vi' ? 'Chọn thành phố' : 'Select city';
                defOpt.disabled = true;
                defOpt.selected = true;
                select.appendChild(defOpt);

                // Đổ danh sách thành phố
                for (const code in cities) {
                    const opt = document.createElement('option');
                    opt.value = code; // ví dụ: HaNoi
                    opt.textContent = cities[code]; // ví dụ: Hà Nội
                    select.appendChild(opt);
                }
            });

            // Khi đổi ngôn ngữ thì dropdown tự cập nhật
            document.addEventListener('languageChanged', (e) => {
                const newLang = e.detail.lang;
                citySelects.forEach(select => {
                    const currentValue = select.value;
                    const cities = window.SKYPLAN_CITY_TRANSLATIONS[newLang];
                    select.innerHTML = '';
                    const defOpt = document.createElement('option');
                    defOpt.textContent = newLang === 'vi' ? 'Chọn thành phố' : 'Select city';
                    defOpt.disabled = true;
                    select.appendChild(defOpt);

                    for (const code in cities) {
                        const opt = document.createElement('option');
                        opt.value = code;
                        opt.textContent = cities[code];
                        if (code === currentValue) opt.selected = true;
                        select.appendChild(opt);
                    }
                });
            });


        })();
    </script>

    <script>
        document.getElementById('spSearchForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const lang = localStorage.getItem('preferredLanguage') || 'vi';
            const dict = window.SKYPLAN_CITY_TRANSLATIONS[lang];

            const fromCode = document.getElementById('fromCity').value;
            const toCode = document.getElementById('toCity').value;
            const fromName = dict[fromCode];
            const toName = dict[toCode];

            const depart = document.getElementById('departDay').value;
            const ret = document.getElementById('returnDay').value;

            const data = {
                fromCode,
                fromName,
                toCode,
                toName,
                depart,
                ret
            };
            sessionStorage.setItem('skyplan:lastSearch', JSON.stringify(data));
            location.href = `search.html?from=${fromCode}&to=${toCode}&depart=${depart}&ret=${ret}`;
        });
    </script>



    <script>
        (function() {
            const KEY = 'skyplan:lastSearch';

            function getLang() {
                return localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'vi';
            }

            function getDict(lang) {
                return (window.SKYPLAN_CITY_TRANSLATIONS && window.SKYPLAN_CITY_TRANSLATIONS[lang]) || {};
            }


            function readState() {
                const p = new URLSearchParams(location.search);
                let state = {
                    from: p.get('from') || '',
                    to: p.get('to') || '',
                    depart: p.get('depart') || '',
                    ret: p.get('ret') || '',
                };
                if ((!state.from || !state.to) && sessionStorage.getItem(KEY)) {
                    try {
                        const s = JSON.parse(sessionStorage.getItem(KEY));
                        state.from = state.from || s.fromCode || '';
                        state.to = state.to || s.toCode || '';
                        state.depart = state.depart || s.depart || '';
                        state.ret = state.ret || s.ret || '';
                    } catch {}
                }
                return state;
            }

            function ensureOption(select, code, label) {
                if (!select || !code) return;
                const found = Array.from(select.options).some(o => o.value === code);
                if (!found) {
                    const opt = document.createElement('option');
                    opt.value = code;
                    opt.textContent = label || code;
                    select.appendChild(opt);
                }
                select.value = code;
            }

            function applyState(state) {
                const lang = getLang();
                const dict = getDict(lang);

                const fromSel = document.getElementById('fromCity');
                const toSel = document.getElementById('toCity');

                ensureOption(fromSel, state.from, dict[state.from]);
                ensureOption(toSel, state.to, dict[state.to]);

                const depart = document.getElementById('dep');
                const ret = document.getElementById('ret');
                if (depart && state.depart) depart.value = state.depart;
                if (ret && state.ret) ret.value = state.ret;
            }

            function relabelSelects() {
                const lang = getLang();
                const dict = getDict(lang);
                ['fromCity', 'toCity'].forEach(id => {
                    const sel = document.getElementById(id);
                    if (!sel) return;
                    Array.from(sel.options).forEach(opt => {
                        if (dict[opt.value]) opt.textContent = dict[opt.value];
                    });
                });
            }

            document.addEventListener('DOMContentLoaded', () => {
                const state = readState();
                applyState(state);
            });

            document.addEventListener('languageChanged', relabelSelects);
        })();
    </script>

    <script>
        (function() {
            // Bảng song ngữ theo mã IATA (bổ sung thêm nếu cần)
            const CITY_BY_CODE = {
                HAN: {
                    vi: 'Hà Nội',
                    en: 'Ha Noi'
                },
                SGN: {
                    vi: 'Hồ Chí Minh',
                    en: 'Ho Chi Minh'
                },
                DAD: {
                    vi: 'Đà Nẵng',
                    en: 'Da Nang'
                },
                PQC: {
                    vi: 'Phú Quốc',
                    en: 'Phu Quoc'
                },
                HPH: {
                    vi: 'Hải Phòng',
                    en: 'Hai Phong'
                },
                HUI: {
                    vi: 'Huế',
                    en: 'Hue'
                },
                DLI: {
                    vi: 'Đà Lạt',
                    en: 'Da Lat'
                },
                VCA: {
                    vi: 'Cần Thơ',
                    en: 'Can Tho'
                }
            };

            function getLang() {
                return localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'vi';
            }

            // Tự bắt mã IATA trong text "(XXX)" nếu chưa có data-iata
            function ensureIata(el) {
                if (el.dataset.iata) return el.dataset.iata;
                const m = el.textContent.trim().match(/\(([A-Z]{3})\)\s*$/);
                if (!m) return null;
                el.dataset.iata = m[1];
                return m[1];
            }

            // Cập nhật tên địa điểm theo ngôn ngữ cho cả card & modal
            function renderAirportLabels(lang) {
                const TARGETS = [
                    '.sp-card .sp-meta', // các card kết quả
                    '.sp-modal [data-out-dep-airport]',
                    '.sp-modal [data-out-arr-airport]',
                    '.sp-modal [data-in-dep-airport]',
                    '.sp-modal [data-in-arr-airport]'
                ].join(',');
                document.querySelectorAll(TARGETS).forEach(el => {
                    const code = ensureIata(el);
                    if (!code) return;
                    const row = CITY_BY_CODE[code];
                    if (row && row[lang]) el.textContent = `${row[lang]} (${code})`;
                });
            }

            // Lúc trang load
            document.addEventListener('DOMContentLoaded', () => {
                renderAirportLabels(getLang());
            });

            // Khi header đổi ngôn ngữ
            document.addEventListener('languageChanged', function(e) {
                // dùng cú pháp "an toàn" không optional chaining để khỏi lỗi
                var lang = (e && e.detail && e.detail.lang) || getLang();
                renderAirportLabels(lang);
            });

            // Export nhẹ để gọi sau parseCard
            window.__spRenderAirports = renderAirportLabels;
            window.__spGetLang = getLang;
        })();
    </script>

    <script>
        // hàm phụ an toàn lấy lang
        function getLangSafe(e) {
            return (e && e.detail && e.detail.lang) || localStorage.getItem('preferredLanguage') || 'vi';
        }

        // ====== Lắng nghe đổi ngôn ngữ từ header ======
        document.addEventListener('languageChanged', function(e) {
            const lang = getLangSafe(e);

            // 1) Text tĩnh dùng i18n (nếu bạn có applyTranslations / changeSearchLanguage)
            if (typeof changeSearchLanguage === 'function') changeSearchLanguage(lang);
            if (typeof initSearchTranslations === 'function') initSearchTranslations(lang);

            // 2) Relabel dropdown From/To (không thay value đang chọn)
            (function relabelSelects() {
                const dict = (window.SKYPLAN_CITY_TRANSLATIONS && window.SKYPLAN_CITY_TRANSLATIONS[lang]) || {};
                ['fromCity', 'toCity'].forEach(id => {
                    const sel = document.getElementById(id);
                    if (!sel) return;
                    Array.from(sel.options).forEach(opt => {
                        if (dict[opt.value]) opt.textContent = dict[opt.value];
                    });
                });
            })();

            // 3) Đổi city labels trong **card kết quả + modal**
            if (typeof window.__spRenderAirports === 'function') window.__spRenderAirports(lang);

            // 4) Thông điệp "không có chuyến bay" (nếu có phần tử này)
            const empty = document.querySelector('.sp-empty, [data-empty]');
            if (empty) empty.textContent = (lang === 'vi') ?
                'Không có chuyến bay phù hợp với bộ lọc.' :
                'No flights match your filters.';

            // 5) Nút/CTA trong modal (nếu đang mở)
            if (window.MODAL_I18N && window.MODAL_I18N[lang]) {
                const btn = document.getElementById('spBookBtn');
                const priceEl = document.querySelector('.sp-modal .sp-price');
                const price = priceEl ? priceEl.textContent : '';
                if (btn) btn.textContent = window.MODAL_I18N[lang].bookPrefix + price;
            }
        });

        // ====== Gọi một lần khi trang vừa load (đồng bộ ngay với ngôn ngữ hiện tại) ======
        document.addEventListener('DOMContentLoaded', function() {
            const lang = localStorage.getItem('preferredLanguage') || document.documentElement.lang || 'vi';
            document.dispatchEvent(new CustomEvent('languageChanged', {
                detail: {
                    lang
                }
            }));
        });
    </script>


</body>

</html>